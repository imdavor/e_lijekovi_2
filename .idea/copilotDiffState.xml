<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/e_lijekovi_2/ui/components/ProductCard.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/e_lijekovi_2/ui/components/ProductCard.kt" />
              <option name="originalContent" value="@file:Suppress(&quot;UNUSED_PARAMETER&quot;, &quot;UNUSED_VARIABLE&quot;, &quot;UNUSED_IMPORT&quot;, &quot;REDUNDANT_QUALIFIER&quot;, &quot;UNUSED_VALUE&quot;)&#10;&#10;package com.example.e_lijekovi_2.ui.components&#10;&#10;import androidx.compose.animation.core.animateFloatAsState&#10;import androidx.compose.animation.core.spring&#10;import androidx.compose.foundation.layout.*&#10;import androidx.compose.foundation.shape.RoundedCornerShape&#10;import androidx.compose.material3.*&#10;import androidx.compose.material.icons.Icons&#10;import androidx.compose.material.icons.filled.AddShoppingCart&#10;import androidx.compose.material.icons.filled.MedicalServices&#10;import androidx.compose.material.icons.filled.Schedule&#10;import androidx.compose.runtime.*&#10;import androidx.compose.ui.Alignment&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.draw.clip&#10;import androidx.compose.ui.draw.scale&#10;import androidx.compose.ui.graphics.Color&#10;import androidx.compose.ui.text.font.FontWeight&#10;import androidx.compose.ui.unit.dp&#10;import androidx.compose.ui.unit.sp&#10;import com.example.e_lijekovi_2.Lijek&#10;import com.example.e_lijekovi_2.DobaDana&#10;import com.example.e_lijekovi_2.IntervalnoUzimanje&#10;import com.example.e_lijekovi_2.TipUzimanja&#10;&#10;// Prilagođeni model proizvoda&#10;// Po potrebi proširi ili promijeni polja&#10;&#10;data class Product(&#10;    val id: Int,&#10;    val name: String,&#10;    val price: String,&#10;    val subtitle: String = &quot;&quot;,&#10;    val colorHex: String = &quot;#F1F8E9&quot; // fallback boja&#10;)&#10;&#10;@Composable&#10;fun ProductCard(&#10;    product: Product,&#10;    onAdd: () -&gt; Unit,&#10;    modifier: Modifier = Modifier&#10;) {&#10;    var added by remember { mutableStateOf(false) }&#10;    val scale by animateFloatAsState(&#10;        targetValue = if (added) 1.04f else 1.0f,&#10;        animationSpec = spring(dampingRatio = 0.6f, stiffness = 250f),&#10;    )&#10;&#10;    Card(&#10;        modifier = modifier&#10;            .width(170.dp)&#10;            .wrapContentHeight()&#10;            .scale(scale),&#10;        shape = RoundedCornerShape(16.dp),&#10;        elevation = CardDefaults.cardElevation(defaultElevation = 6.dp),&#10;        colors = CardDefaults.cardColors(containerColor = MaterialTheme.colorScheme.surface)&#10;    ) {&#10;        Column(&#10;            modifier = Modifier&#10;                .padding(12.dp)&#10;        ) {&#10;            // Placeholder za sliku (zamijeni Coil/AsyncImage po potrebi)&#10;            Surface(&#10;                modifier = Modifier&#10;                    .height(110.dp)&#10;                    .fillMaxWidth()&#10;                    .clip(RoundedCornerShape(12.dp)),&#10;                tonalElevation = 2.dp,&#10;                shape = RoundedCornerShape(12.dp),&#10;                color = MaterialTheme.colorScheme.surfaceVariant&#10;            ) {&#10;                Box(contentAlignment = Alignment.Center) {&#10;                    Text(&#10;                        text = &quot;Slika&quot;,&#10;                        color = MaterialTheme.colorScheme.onSurfaceVariant&#10;                    )&#10;                }&#10;            }&#10;&#10;            Spacer(modifier = Modifier.height(10.dp))&#10;&#10;            Text(&#10;                text = product.name,&#10;                fontWeight = FontWeight.SemiBold,&#10;                fontSize = 14.sp,&#10;                color = MaterialTheme.colorScheme.onSurface,&#10;                maxLines = 2&#10;            )&#10;            if (product.subtitle.isNotEmpty()) {&#10;                Text(&#10;                    text = product.subtitle,&#10;                    fontSize = 12.sp,&#10;                    color = MaterialTheme.colorScheme.onSurfaceVariant&#10;                )&#10;            }&#10;&#10;            Spacer(modifier = Modifier.height(8.dp))&#10;&#10;            Row(&#10;                verticalAlignment = Alignment.CenterVertically,&#10;                horizontalArrangement = Arrangement.SpaceBetween,&#10;                modifier = Modifier.fillMaxWidth()&#10;            ) {&#10;                Column {&#10;                    Text(&#10;                        text = product.price,&#10;                        fontWeight = FontWeight.Bold,&#10;                        color = MaterialTheme.colorScheme.primary&#10;                    )&#10;                }&#10;&#10;                Button(&#10;                    onClick = {&#10;                        added = true&#10;                        onAdd()&#10;                    },&#10;                    colors = ButtonDefaults.buttonColors(&#10;                        containerColor = MaterialTheme.colorScheme.primary,&#10;                        contentColor = MaterialTheme.colorScheme.onPrimary&#10;                    ),&#10;                    shape = RoundedCornerShape(12.dp),&#10;                    contentPadding = PaddingValues(8.dp)&#10;                ) {&#10;                    Icon(imageVector = Icons.Default.AddShoppingCart, contentDescription = null)&#10;                }&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;fun LijekCard(&#10;    lijek: Lijek,&#10;    onTake: () -&gt; Unit,&#10;    modifier: Modifier = Modifier&#10;) {&#10;    // remove global jeUzet that hides per-dose availability; rely on mozeUzeti for each button enablement&#10;    // val jeUzet = lijek.jeUzetZaDanas()&#10;    // restore compliance stats text&#10;    val complianceStats = when (lijek.tipUzimanja) {&#10;        TipUzimanja.INTERVALNO -&gt; lijek.intervalnoUzimanje?.getComplianceStats(7)&#10;        else -&gt; null&#10;    }&#10;    val complianceText = complianceStats?.let { &quot;Uzimanje: ${it.complianceRate.toInt()}% u zadnjih 7 dana&quot; } ?: &quot;&quot;&#10;&#10;    val mozeUzeti = when (lijek.tipUzimanja) {&#10;        TipUzimanja.INTERVALNO -&gt; {&#10;            val ih = lijek.intervalnoUzimanje&#10;            val next = ih?.sljedeceVrijeme()&#10;            ih != null &amp;&amp; next != null &amp;&amp; lijek.trenutnoStanje &gt; 0 &amp;&amp; ih.complianceHistory.none { it.scheduledTime == next &amp;&amp; it.date == IntervalnoUzimanje.createDateFormat().format(java.util.Date()) }&#10;        }&#10;        TipUzimanja.STANDARDNO -&gt; {&#10;            val moguJutro = lijek.jutro &amp;&amp; (lijek.dozeZaDan[DobaDana.JUTRO] != true) &amp;&amp; lijek.trenutnoStanje &gt; 0&#10;            val moguPodne = lijek.popodne &amp;&amp; (lijek.dozeZaDan[DobaDana.POPODNE] != true) &amp;&amp; lijek.trenutnoStanje &gt; 0&#10;            val moguVecer = lijek.vecer &amp;&amp; (lijek.dozeZaDan[DobaDana.VECER] != true) &amp;&amp; lijek.trenutnoStanje &gt; 0&#10;            (moguJutro || moguPodne || moguVecer)&#10;        }&#10;    }&#10;&#10;    // Compute last-taking text: prefer actual complianceHistory; for STANDARDNO if none, show which doze are still available today&#10;    val zadnjeUzimanjeTekst = run {&#10;        val zadnje = lijek.complianceHistory.lastOrNull { it.actualTime != null }&#10;        if (zadnje != null) {&#10;            &quot;Zadnje: ${zadnje.date} u ${zadnje.actualTime}&quot;&#10;        } else {&#10;            if (lijek.tipUzimanja == TipUzimanja.STANDARDNO) {&#10;                val available = mutableListOf&lt;String&gt;()&#10;                if (lijek.jutro &amp;&amp; (lijek.dozeZaDan[DobaDana.JUTRO] != true)) available.add(&quot;Jutro ${lijek.vrijemeJutro}&quot;)&#10;                if (lijek.popodne &amp;&amp; (lijek.dozeZaDan[DobaDana.POPODNE] != true)) available.add(&quot;Podne ${lijek.vrijemePopodne}&quot;)&#10;                if (lijek.vecer &amp;&amp; (lijek.dozeZaDan[DobaDana.VECER] != true)) available.add(&quot;Večer ${lijek.vrijemeVecer}&quot;)&#10;                if (available.isNotEmpty()) &quot;Dostupno: ${available.joinToString(&quot;, &quot;)}&quot; else &quot;Nema podataka&quot;&#10;            } else {&#10;                &quot;Nema podataka&quot;&#10;            }&#10;        }&#10;    }&#10;&#10;    Card(&#10;        modifier = modifier&#10;            .fillMaxWidth()&#10;            .wrapContentHeight(), // Uklonjen padding na dnu, padding treba dodati samo zadnjoj kartici u prikazu liste&#10;        shape = RoundedCornerShape(16.dp),&#10;        elevation = CardDefaults.cardElevation(defaultElevation = 6.dp),&#10;        colors = CardDefaults.cardColors(&#10;            containerColor = run {&#10;                // parse unitsPerDose from `doza` (first integer found), default 1&#10;                val unitsPerDose = lijek.doza.trim().let { d -&gt; Regex(&quot;\\d+&quot;).find(d)?.value?.toIntOrNull() ?: 1 }&#10;&#10;                val dosesPerDay = when (lijek.tipUzimanja) {&#10;                    TipUzimanja.STANDARDNO -&gt; {&#10;                        val stdTimes = listOf(lijek.jutro, lijek.popodne, lijek.vecer).count { it }&#10;                        if (stdTimes &gt; 0) stdTimes.toDouble() else 1.0&#10;                    }&#10;                    TipUzimanja.INTERVALNO -&gt; {&#10;                        val interval = lijek.intervalnoUzimanje?.intervalSati ?: 0&#10;                        if (interval &gt; 0) 24.0 / interval else 1.0&#10;                    }&#10;                }&#10;&#10;                val dailyConsumption = unitsPerDose * dosesPerDay&#10;                val daysRemaining = if (dailyConsumption &gt; 0.0) lijek.trenutnoStanje.toDouble() / dailyConsumption else Double.POSITIVE_INFINITY&#10;&#10;                val isYellow = (lijek.trenutnoStanje &lt;= 7) || (dosesPerDay &gt;= 2.0 &amp;&amp; lijek.trenutnoStanje &lt;= 14) || (daysRemaining &lt;= 7.0)&#10;&#10;                if (isYellow) Color(0xFFFFF59D) else MaterialTheme.colorScheme.surface&#10;            }&#10;        )&#10;    ) {&#10;        Row(&#10;            modifier = Modifier.padding(12.dp),&#10;            verticalAlignment = Alignment.CenterVertically&#10;        ) {&#10;            // Kvadratić sa slikom (ikonom)&#10;            Surface(&#10;                modifier = Modifier&#10;                    .size(56.dp)&#10;                    .clip(RoundedCornerShape(10.dp)),&#10;                tonalElevation = 2.dp,&#10;                shape = RoundedCornerShape(10.dp),&#10;                color = MaterialTheme.colorScheme.surfaceVariant&#10;            ) {&#10;                Box(contentAlignment = Alignment.Center) {&#10;                    Icon(&#10;                        imageVector = Icons.Default.MedicalServices,&#10;                        contentDescription = &quot;Lijek ikona&quot;,&#10;                        tint = MaterialTheme.colorScheme.onSurfaceVariant.copy(alpha = 0.5f),&#10;                        modifier = Modifier.size(32.dp)&#10;                    )&#10;                }&#10;            }&#10;            Spacer(modifier = Modifier.width(14.dp))&#10;            // Tekstualni podaci i gumb&#10;            Column(modifier = Modifier.weight(1f)) {&#10;                Row(&#10;                    verticalAlignment = Alignment.CenterVertically,&#10;                    modifier = Modifier.fillMaxWidth()&#10;                ) {&#10;                    if (lijek.tipUzimanja == TipUzimanja.INTERVALNO) {&#10;                        Icon(&#10;                            imageVector = Icons.Default.Schedule,&#10;                            contentDescription = &quot;Intervalni lijek&quot;,&#10;                            tint = MaterialTheme.colorScheme.onSurfaceVariant.copy(alpha = 0.7f),&#10;                            modifier = Modifier.size(16.dp).padding(end = 4.dp)&#10;                        )&#10;                    }&#10;                    Text(&#10;                        text = lijek.naziv,&#10;                        fontWeight = FontWeight.SemiBold,&#10;                        fontSize = 16.sp,&#10;                        color = MaterialTheme.colorScheme.onSurface,&#10;                        maxLines = 2,&#10;                        modifier = Modifier.weight(1f)&#10;                    )&#10;                    if (lijek.cijena.isNotBlank()) {&#10;                        val cijenaFormatted = try {&#10;                            lijek.cijena.replace(',', '.').toFloat().let { String.format(&quot;%.2f €&quot;, it) }&#10;                        } catch (_: Exception) {&#10;                            lijek.cijena + &quot; €&quot;&#10;                        }&#10;                        Text(&#10;                            text = cijenaFormatted.replace('.', ','),&#10;                            fontSize = 20.sp,&#10;                            color = MaterialTheme.colorScheme.primary,&#10;                            fontWeight = FontWeight.Bold,&#10;                            maxLines = 1,&#10;                            modifier = Modifier&#10;                        )&#10;                    }&#10;                }&#10;                if (lijek.napomene.isNotBlank()) {&#10;                    Text(&#10;                        text = lijek.napomene,&#10;                        fontSize = 11.sp,&#10;                        color = MaterialTheme.colorScheme.onSurfaceVariant&#10;                    )&#10;                }&#10;&#10;                Spacer(modifier = Modifier.height(4.dp))&#10;                Text(&#10;                    text = zadnjeUzimanjeTekst,&#10;                    fontSize = 11.sp,&#10;                    color = MaterialTheme.colorScheme.onSurfaceVariant&#10;                )&#10;                if (complianceText.isNotBlank()) {&#10;                    Text(&#10;                        text = complianceText,&#10;                        fontSize = 11.sp,&#10;                        color = MaterialTheme.colorScheme.onSurfaceVariant&#10;                    )&#10;                }&#10;                Spacer(modifier = Modifier.height(6.dp))&#10;                Row(&#10;                    verticalAlignment = Alignment.CenterVertically,&#10;                    horizontalArrangement = Arrangement.SpaceBetween,&#10;                    modifier = Modifier.fillMaxWidth()&#10;                ) {&#10;                    // Stanje lijevo&#10;                    Text(&#10;                        text = &quot;${lijek.trenutnoStanje} od ${lijek.pakiranje}&quot;,&#10;                        fontSize = 12.sp,&#10;                        color = MaterialTheme.colorScheme.onSurfaceVariant&#10;                    )&#10;                    Spacer(modifier = Modifier.width(8.dp))&#10;                    // Gumb desno&#10;                    Button(&#10;                        onClick = onTake,&#10;                        enabled = mozeUzeti,&#10;                        colors = ButtonDefaults.buttonColors(&#10;                            containerColor = MaterialTheme.colorScheme.primary,&#10;                            contentColor = MaterialTheme.colorScheme.onPrimary&#10;                        ),&#10;                        modifier = Modifier&#10;                    ) {&#10;                        Text(&quot;✓ Uzmi&quot;)&#10;                    }&#10;                }&#10;            }&#10;        }&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="@file:Suppress(&quot;UNUSED_PARAMETER&quot;, &quot;UNUSED_VARIABLE&quot;, &quot;UNUSED_IMPORT&quot;, &quot;REDUNDANT_QUALIFIER&quot;, &quot;UNUSED_VALUE&quot;)&#10;&#10;package com.example.e_lijekovi_2.ui.components&#10;&#10;import androidx.compose.animation.core.animateFloatAsState&#10;import androidx.compose.animation.core.spring&#10;import androidx.compose.foundation.layout.*&#10;import androidx.compose.foundation.shape.RoundedCornerShape&#10;import androidx.compose.material3.*&#10;import androidx.compose.material.icons.Icons&#10;import androidx.compose.material.icons.filled.AddShoppingCart&#10;import androidx.compose.material.icons.filled.MedicalServices&#10;import androidx.compose.material.icons.filled.Schedule&#10;import androidx.compose.runtime.*&#10;import androidx.compose.ui.Alignment&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.draw.clip&#10;import androidx.compose.ui.draw.scale&#10;import androidx.compose.ui.graphics.Color&#10;import androidx.compose.ui.text.font.FontWeight&#10;import androidx.compose.ui.unit.dp&#10;import androidx.compose.ui.unit.sp&#10;import com.example.e_lijekovi_2.Lijek&#10;import com.example.e_lijekovi_2.DobaDana&#10;import com.example.e_lijekovi_2.IntervalnoUzimanje&#10;import com.example.e_lijekovi_2.TipUzimanja&#10;&#10;// Prilagođeni model proizvoda&#10;// Po potrebi proširi ili promijeni polja&#10;&#10;data class Product(&#10;    val id: Int,&#10;    val name: String,&#10;    val price: String,&#10;    val subtitle: String = &quot;&quot;,&#10;    val colorHex: String = &quot;#F1F8E9&quot; // fallback boja&#10;)&#10;&#10;@Composable&#10;fun ProductCard(&#10;    product: Product,&#10;    onAdd: () -&gt; Unit,&#10;    modifier: Modifier = Modifier&#10;) {&#10;    var added by remember { mutableStateOf(false) }&#10;    val scale by animateFloatAsState(&#10;        targetValue = if (added) 1.04f else 1.0f,&#10;        animationSpec = spring(dampingRatio = 0.6f, stiffness = 250f),&#10;    )&#10;&#10;    Card(&#10;        modifier = modifier&#10;            .width(170.dp)&#10;            .wrapContentHeight()&#10;            .scale(scale),&#10;        shape = RoundedCornerShape(16.dp),&#10;        elevation = CardDefaults.cardElevation(defaultElevation = 6.dp),&#10;        colors = CardDefaults.cardColors(containerColor = MaterialTheme.colorScheme.surface)&#10;    ) {&#10;        Column(&#10;            modifier = Modifier&#10;                .padding(12.dp)&#10;        ) {&#10;            // Placeholder za sliku (zamijeni Coil/AsyncImage po potrebi)&#10;            Surface(&#10;                modifier = Modifier&#10;                    .height(110.dp)&#10;                    .fillMaxWidth()&#10;                    .clip(RoundedCornerShape(12.dp)),&#10;                tonalElevation = 2.dp,&#10;                shape = RoundedCornerShape(12.dp),&#10;                color = MaterialTheme.colorScheme.surfaceVariant&#10;            ) {&#10;                Box(contentAlignment = Alignment.Center) {&#10;                    Text(&#10;                        text = &quot;Slika&quot;,&#10;                        color = MaterialTheme.colorScheme.onSurfaceVariant&#10;                    )&#10;                }&#10;            }&#10;&#10;            Spacer(modifier = Modifier.height(10.dp))&#10;&#10;            Text(&#10;                text = product.name,&#10;                fontWeight = FontWeight.SemiBold,&#10;                fontSize = 14.sp,&#10;                color = MaterialTheme.colorScheme.onSurface,&#10;                maxLines = 2&#10;            )&#10;            if (product.subtitle.isNotEmpty()) {&#10;                Text(&#10;                    text = product.subtitle,&#10;                    fontSize = 12.sp,&#10;                    color = MaterialTheme.colorScheme.onSurfaceVariant&#10;                )&#10;            }&#10;&#10;            Spacer(modifier = Modifier.height(8.dp))&#10;&#10;            Row(&#10;                verticalAlignment = Alignment.CenterVertically,&#10;                horizontalArrangement = Arrangement.SpaceBetween,&#10;                modifier = Modifier.fillMaxWidth()&#10;            ) {&#10;                Column {&#10;                    Text(&#10;                        text = product.price,&#10;                        fontWeight = FontWeight.Bold,&#10;                        color = MaterialTheme.colorScheme.primary&#10;                    )&#10;                }&#10;&#10;                Button(&#10;                    onClick = {&#10;                        added = true&#10;                        onAdd()&#10;                    },&#10;                    colors = ButtonDefaults.buttonColors(&#10;                        containerColor = MaterialTheme.colorScheme.primary,&#10;                        contentColor = MaterialTheme.colorScheme.onPrimary&#10;                    ),&#10;                    shape = RoundedCornerShape(12.dp),&#10;                    contentPadding = PaddingValues(8.dp)&#10;                ) {&#10;                    Icon(imageVector = Icons.Default.AddShoppingCart, contentDescription = null)&#10;                }&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;fun LijekCard(&#10;    lijek: Lijek,&#10;    onTake: () -&gt; Unit,&#10;    modifier: Modifier = Modifier&#10;) {&#10;    // remove global jeUzet that hides per-dose availability; rely on mozeUzeti for each button enablement&#10;    // val jeUzet = lijek.jeUzetZaDanas()&#10;    // restore compliance stats text&#10;    val complianceStats = when (lijek.tipUzimanja) {&#10;        TipUzimanja.INTERVALNO -&gt; lijek.intervalnoUzimanje?.getComplianceStats(7)&#10;        else -&gt; null&#10;    }&#10;    val complianceText = complianceStats?.let { &quot;Uzimanje: ${it.complianceRate.toInt()}% u zadnjih 7 dana&quot; } ?: &quot;&quot;&#10;&#10;    // Compute small dose-pattern like 1x0x1 for STANDARDNO drugs: 1 = scheduled &amp;&amp; not yet taken today, 0 = not scheduled or already taken&#10;    val dosePattern = if (lijek.tipUzimanja == TipUzimanja.STANDARDNO) {&#10;        val j = if (lijek.jutro &amp;&amp; (lijek.dozeZaDan[DobaDana.JUTRO] != true)) &quot;1&quot; else &quot;0&quot;&#10;        val p = if (lijek.popodne &amp;&amp; (lijek.dozeZaDan[DobaDana.POPODNE] != true)) &quot;1&quot; else &quot;0&quot;&#10;        val v = if (lijek.vecer &amp;&amp; (lijek.dozeZaDan[DobaDana.VECER] != true)) &quot;1&quot; else &quot;0&quot;&#10;        &quot;${j}x${p}x${v}&quot;&#10;    } else &quot;&quot;&#10;&#10;    val mozeUzeti = when (lijek.tipUzimanja) {&#10;        TipUzimanja.INTERVALNO -&gt; {&#10;            val ih = lijek.intervalnoUzimanje&#10;            val next = ih?.sljedeceVrijeme()&#10;            ih != null &amp;&amp; next != null &amp;&amp; lijek.trenutnoStanje &gt; 0 &amp;&amp; ih.complianceHistory.none { it.scheduledTime == next &amp;&amp; it.date == IntervalnoUzimanje.createDateFormat().format(java.util.Date()) }&#10;        }&#10;        TipUzimanja.STANDARDNO -&gt; {&#10;            val moguJutro = lijek.jutro &amp;&amp; (lijek.dozeZaDan[DobaDana.JUTRO] != true) &amp;&amp; lijek.trenutnoStanje &gt; 0&#10;            val moguPodne = lijek.popodne &amp;&amp; (lijek.dozeZaDan[DobaDana.POPODNE] != true) &amp;&amp; lijek.trenutnoStanje &gt; 0&#10;            val moguVecer = lijek.vecer &amp;&amp; (lijek.dozeZaDan[DobaDana.VECER] != true) &amp;&amp; lijek.trenutnoStanje &gt; 0&#10;            (moguJutro || moguPodne || moguVecer)&#10;        }&#10;    }&#10;&#10;    // Compute last-taking text: prefer actual complianceHistory; for STANDARDNO if none, show which doze are still available today&#10;    val zadnjeUzimanjeTekst = run {&#10;        val zadnje = lijek.complianceHistory.lastOrNull { it.actualTime != null }&#10;        if (zadnje != null) {&#10;            &quot;Zadnje: ${zadnje.date} u ${zadnje.actualTime}&quot;&#10;        } else {&#10;            if (lijek.tipUzimanja == TipUzimanja.STANDARDNO) {&#10;                val available = mutableListOf&lt;String&gt;()&#10;                if (lijek.jutro &amp;&amp; (lijek.dozeZaDan[DobaDana.JUTRO] != true)) available.add(&quot;Jutro ${lijek.vrijemeJutro}&quot;)&#10;                if (lijek.popodne &amp;&amp; (lijek.dozeZaDan[DobaDana.POPODNE] != true)) available.add(&quot;Podne ${lijek.vrijemePopodne}&quot;)&#10;                if (lijek.vecer &amp;&amp; (lijek.dozeZaDan[DobaDana.VECER] != true)) available.add(&quot;Večer ${lijek.vrijemeVecer}&quot;)&#10;                if (available.isNotEmpty()) &quot;Dostupno: ${available.joinToString(&quot;, &quot;)}&quot; else &quot;Nema podataka&quot;&#10;            } else {&#10;                &quot;Nema podataka&quot;&#10;            }&#10;        }&#10;    }&#10;&#10;    Card(&#10;        modifier = modifier&#10;            .fillMaxWidth()&#10;            .wrapContentHeight(), // Uklonjen padding na dnu, padding treba dodati samo zadnjoj kartici u prikazu liste&#10;        shape = RoundedCornerShape(16.dp),&#10;        elevation = CardDefaults.cardElevation(defaultElevation = 6.dp),&#10;        colors = CardDefaults.cardColors(&#10;            containerColor = run {&#10;                // parse unitsPerDose from `doza` (first integer found), default 1&#10;                val unitsPerDose = lijek.doza.trim().let { d -&gt; Regex(&quot;\\d+&quot;).find(d)?.value?.toIntOrNull() ?: 1 }&#10;&#10;                val dosesPerDay = when (lijek.tipUzimanja) {&#10;                    TipUzimanja.STANDARDNO -&gt; {&#10;                        val stdTimes = listOf(lijek.jutro, lijek.popodne, lijek.vecer).count { it }&#10;                        if (stdTimes &gt; 0) stdTimes.toDouble() else 1.0&#10;                    }&#10;                    TipUzimanja.INTERVALNO -&gt; {&#10;                        val interval = lijek.intervalnoUzimanje?.intervalSati ?: 0&#10;                        if (interval &gt; 0) 24.0 / interval else 1.0&#10;                    }&#10;                }&#10;&#10;                val dailyConsumption = unitsPerDose * dosesPerDay&#10;                val daysRemaining = if (dailyConsumption &gt; 0.0) lijek.trenutnoStanje.toDouble() / dailyConsumption else Double.POSITIVE_INFINITY&#10;&#10;                val isYellow = (lijek.trenutnoStanje &lt;= 7) || (dosesPerDay &gt;= 2.0 &amp;&amp; lijek.trenutnoStanje &lt;= 14) || (daysRemaining &lt;= 7.0)&#10;&#10;                if (isYellow) Color(0xFFFFF59D) else MaterialTheme.colorScheme.surface&#10;            }&#10;        )&#10;    ) {&#10;        Row(&#10;            modifier = Modifier.padding(12.dp),&#10;            verticalAlignment = Alignment.CenterVertically&#10;        ) {&#10;            // Kvadratić sa slikom (ikonom)&#10;            Surface(&#10;                modifier = Modifier&#10;                    .size(56.dp)&#10;                    .clip(RoundedCornerShape(10.dp)),&#10;                tonalElevation = 2.dp,&#10;                shape = RoundedCornerShape(10.dp),&#10;                color = MaterialTheme.colorScheme.surfaceVariant&#10;            ) {&#10;                // Show icon and small dose pattern underneath to visually indicate which times are still available today&#10;                Column(&#10;                    modifier = Modifier.fillMaxSize(),&#10;                    horizontalAlignment = Alignment.CenterHorizontally,&#10;                    verticalArrangement = Arrangement.Center&#10;                ) {&#10;                    Icon(&#10;                        imageVector = Icons.Default.MedicalServices,&#10;                        contentDescription = &quot;Lijek ikona&quot;,&#10;                        tint = MaterialTheme.colorScheme.onSurfaceVariant.copy(alpha = 0.5f),&#10;                        modifier = Modifier.size(32.dp)&#10;                    )&#10;                    if (dosePattern.isNotBlank()) {&#10;                        Spacer(modifier = Modifier.height(4.dp))&#10;                        Text(&#10;                            text = dosePattern,&#10;                            fontSize = 10.sp,&#10;                            color = MaterialTheme.colorScheme.onSurfaceVariant&#10;                        )&#10;                    }&#10;                }&#10;            }&#10;            Spacer(modifier = Modifier.width(14.dp))&#10;            // Tekstualni podaci i gumb&#10;            Column(modifier = Modifier.weight(1f)) {&#10;                Row(&#10;                    verticalAlignment = Alignment.CenterVertically,&#10;                    modifier = Modifier.fillMaxWidth()&#10;                ) {&#10;                    if (lijek.tipUzimanja == TipUzimanja.INTERVALNO) {&#10;                        Icon(&#10;                            imageVector = Icons.Default.Schedule,&#10;                            contentDescription = &quot;Intervalni lijek&quot;,&#10;                            tint = MaterialTheme.colorScheme.onSurfaceVariant.copy(alpha = 0.7f),&#10;                            modifier = Modifier.size(16.dp).padding(end = 4.dp)&#10;                        )&#10;                    }&#10;                    Text(&#10;                        text = lijek.naziv,&#10;                        fontWeight = FontWeight.SemiBold,&#10;                        fontSize = 16.sp,&#10;                        color = MaterialTheme.colorScheme.onSurface,&#10;                        maxLines = 2,&#10;                        modifier = Modifier.weight(1f)&#10;                    )&#10;                    if (lijek.cijena.isNotBlank()) {&#10;                        val cijenaFormatted = try {&#10;                            lijek.cijena.replace(',', '.').toFloat().let { String.format(&quot;%.2f €&quot;, it) }&#10;                        } catch (_: Exception) {&#10;                            lijek.cijena + &quot; €&quot;&#10;                        }&#10;                        Text(&#10;                            text = cijenaFormatted.replace('.', ','),&#10;                            fontSize = 20.sp,&#10;                            color = MaterialTheme.colorScheme.primary,&#10;                            fontWeight = FontWeight.Bold,&#10;                            maxLines = 1,&#10;                            modifier = Modifier&#10;                        )&#10;                    }&#10;                }&#10;                if (lijek.napomene.isNotBlank()) {&#10;                    Text(&#10;                        text = lijek.napomene,&#10;                        fontSize = 11.sp,&#10;                        color = MaterialTheme.colorScheme.onSurfaceVariant&#10;                    )&#10;                }&#10;&#10;                Spacer(modifier = Modifier.height(4.dp))&#10;                Text(&#10;                    text = zadnjeUzimanjeTekst,&#10;                    fontSize = 11.sp,&#10;                    color = MaterialTheme.colorScheme.onSurfaceVariant&#10;                )&#10;                if (complianceText.isNotBlank()) {&#10;                    Text(&#10;                        text = complianceText,&#10;                        fontSize = 11.sp,&#10;                        color = MaterialTheme.colorScheme.onSurfaceVariant&#10;                    )&#10;                }&#10;                Spacer(modifier = Modifier.height(6.dp))&#10;                Row(&#10;                    verticalAlignment = Alignment.CenterVertically,&#10;                    horizontalArrangement = Arrangement.SpaceBetween,&#10;                    modifier = Modifier.fillMaxWidth()&#10;                ) {&#10;                    // Stanje lijevo&#10;                    Text(&#10;                        text = &quot;${lijek.trenutnoStanje} od ${lijek.pakiranje}&quot;,&#10;                        fontSize = 12.sp,&#10;                        color = MaterialTheme.colorScheme.onSurfaceVariant&#10;                    )&#10;                    Spacer(modifier = Modifier.width(8.dp))&#10;                    // Gumb desno&#10;                    Button(&#10;                        onClick = onTake,&#10;                        enabled = mozeUzeti,&#10;                        colors = ButtonDefaults.buttonColors(&#10;                            containerColor = MaterialTheme.colorScheme.primary,&#10;                            contentColor = MaterialTheme.colorScheme.onPrimary&#10;                        ),&#10;                        modifier = Modifier&#10;                    ) {&#10;                        Text(&quot;✓ Uzmi&quot;)&#10;                    }&#10;                }&#10;            }&#10;        }&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>